<!DOCTYPE html>
<html lang="en">
{% include "_head.njk" %}

<body>
	<header>
		{%- include "_header.njk" -%}
	</header>

	<main class="page-margins">
		<div class="margin-fix">
			{% if page.url != '/' %}
			<div class="secondary-header pad-bottom-large">
				<h1>{{ navtitle }}</h1>
				{% include "_links.njk" %}
			</div>
			{% endif %}
			{{ content | safe }}
		</div>
	</main>

	{%- include "_footer.njk" -%}

	<script src="/assets/app.js" defer></script>
	{% if "/playground" not in page.url and "/colophon" not in page.url %}
		<script>
			// Lazy-load Cal.js on user interaction with booking links
			(function() {
				let calLoaded = false;

				function loadCal() {
					if (calLoaded) return;
					calLoaded = true;

					const script = document.createElement('script');
					script.src = '/assets/cal.js';
					document.head.appendChild(script);
				}

				function initLazyLoad() {
					const calLinks = document.querySelectorAll('[data-cal-link]');
					if (!calLinks.length) return;

					calLinks.forEach(function(link) {
						// Load on hover (desktop) - gives ~200ms head start
						link.addEventListener('mouseenter', loadCal, { once: true, passive: true });

						// Load on focus (keyboard navigation)
						link.addEventListener('focus', loadCal, { once: true, passive: true });

						// Load on touch start (mobile) - before click fires
						link.addEventListener('touchstart', loadCal, { once: true, passive: true });
					});
				}

				// Initialize when DOM is ready
				if (document.readyState === 'loading') {
					document.addEventListener('DOMContentLoaded', initLazyLoad);
				} else {
					initLazyLoad();
				}
			})();
		</script>
	{% endif %}
</body>

</html>